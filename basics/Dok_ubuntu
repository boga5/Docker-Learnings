#Java app as a service and using nginx
#using official maven image
FROM maven

#copying SpringMVCXML into container
COPY Java_Sample_App/SpringMVCSecurityXML /java_app/SpringMVCSecurityXML

# Set the Work directory
WORKDIR /java_app/SpringMVCSecurityXML

# buuild the application
RUN mvn clean install

#ubuntu image
FROM ubuntu

#install tomcat and nginx
RUN apt-get update
RUN apt-get install tomcat8 nginx open-jdk -y

#setup tomcat8
COPY --from=0 /java_app/SpringMVCSecurityXML/target/SpringMVCSecurityXML.war /usr/local/tomcat8/webapps

#remove the default configuration settings
RUN rm -rf etc/nginx/conf.d/default.conf

#add the new configuration file
COPY ./tomcat-nginx.conf etc/nginx/conf.d/tomcat-nginx.conf

#test and reload new configuration
RUN nginx -t
